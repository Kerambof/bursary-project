{% extends 'bursary/base.html' %}

{% block content %}
<h2>Bursary Application</h2>

<!-- Display messages -->
{% if messages %}
  {% for message in messages %}
    <div 
      style="padding:10px; margin-bottom:10px; border-radius:5px; 
             {% if message.tags == 'success' %}background-color:#d4edda; color:#155724;{% endif %}
             {% if message.tags == 'error' %}background-color:#f8d7da; color:#721c24;{% endif %}
             {% if message.tags == 'info' %}background-color:#cce5ff; color:#004085;{% endif %}">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}

    <button type="submit">Submit Application</button>
</form>

<!-- AJAX for dynamically loading constituencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    const constituencyField = $('#id_constituency');
    const countyField = $('#id_county');

    // Disable constituency field initially if empty
    if (!countyField.val()) {
        constituencyField.prop('disabled', true);
    }

    countyField.change(function() {
        const countyId = $(this).val();
        if (countyId) {
            $.ajax({
                url: "{% url 'load_constituencies' %}",
                data: {
                    'county': countyId
                },
                success: function(data) {
                    constituencyField.empty(); // Clear previous options
                    constituencyField.append('<option value="">Select constituency</option>');
                    data.forEach(function(item) {
                        constituencyField.append('<option value="' + item.id + '">' + item.name + '</option>');
                    });
                    constituencyField.prop('disabled', false);
                }
            });
        } else {
            constituencyField.empty();
            constituencyField.prop('disabled', true);
        }
    });
});
</script>
{% endblock %}
