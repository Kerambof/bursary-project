{% extends 'bursary/base.html' %}

{% block content %}
<div class="dashboard-container">

  <!-- Welcome Header -->
  <div class="welcome-card">
      <div>
          <h2 class="welcome-title">
    Welcome  {{ student_full_name }}
</h2>

          <p class="sub-text">Here is an overview of your bursary applications.</p>
      </div>
      <a href="{% url 'student_logout' %}" class="logout-btn">Logout</a>
  </div>

  <!-- Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="dashboard-message {% if message.tags %}{{ message.tags }}{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- Summary Cards -->
  <div class="summary-section">
      <div class="summary-card">
          <h3>{{ applications|length }}</h3>
          <p>Total Applications</p>
      </div>

      <div class="summary-card pending">
          <h3>
            {{ applications|dictsort:"status"|length }}
          </h3>
          <p>Applications Submitted</p>
      </div>
  </div>

  <h3 class="section-title">Your Applications</h3>

  {% if applications %}
  <div class="table-container">
    <table class="applications-table">
        <thead>
            <tr>
                <th>Admission No</th>
                <th>School</th>
                <th>Course</th>
                <th>Level</th>
                <th>County</th>
                <th>Constituency</th>
                <th>Annual Fee</th>
                <th>Status</th>
                <th>Date Applied</th>
            </tr>
        </thead>
        <tbody>
        {% for app in applications %}
            <tr>
                <td>{{ app.admission_number }}</td>
                <td>{{ app.school }}</td>
                <td>{{ app.course }}</td>
                <td>{{ app.level_of_study.name }}</td>
                <td>{{ app.county.name }}</td>
                <td>{{ app.constituency.name }}</td>
                <td>KES {{ app.amount_requested }}</td>
                <td>
                    {% if app.status == "pending" %}
                        <span class="badge pending">Pending</span>
                    {% elif app.status == "approved" %}
                        <span class="badge approved">Approved</span>
                    {% elif app.status == "rejected" %}
                        <span class="badge rejected">Rejected</span>
                    {% endif %}
                </td>
                <td>{{ app.created_at|date:"M d, Y" }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state">
      <h4>No Applications Yet</h4>
      <p>You have not submitted any bursary applications.</p>
  </div>
  {% endif %}

  <!-- Apply Button -->
  <div class="apply-section">
    {% if applications %}
        {% with applications|dictsortreversed:"created_at"|first as latest_app %}
            {% if latest_app.status == "pending" %}
                <p class="pending-msg">
                    You already have a pending application. Please wait for it to be reviewed.
                </p>
                <button class="apply-btn disabled" disabled>
                    Application Pending
                </button>
            {% else %}
                <a href="{% url 'apply' %}" class="apply-btn">
                    Apply for Bursary
                </a>
            {% endif %}
        {% endwith %}
    {% else %}
        <a href="{% url 'apply' %}" class="apply-btn">
            Apply for Bursary
        </a>
    {% endif %}
  </div>

</div>


<style>

/* Container */
.dashboard-container {
    max-width: 1100px;
    margin: 40px auto;
    padding: 20px;
    font-family: 'Segoe UI', sans-serif;
}

/* Welcome Card */
.welcome-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #4CAF50, #2e7d32);
    color: white;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 25px;
}

.user-name {
    font-weight: bold;
}

.sub-text {
    opacity: 0.9;
    font-size: 14px;
}

.logout-btn {
    background: white;
    color: #2e7d32;
    padding: 8px 15px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 500;
    transition: 0.3s;
}

.logout-btn:hover {
    background: #f1f1f1;
}

/* Summary Cards */
.summary-section {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}

.summary-card {
    flex: 1;
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.summary-card h3 {
    font-size: 28px;
    margin-bottom: 5px;
    color: #2e7d32;
}

/* Section Title */
.section-title {
    margin-bottom: 15px;
}

/* Table */
.table-container {
    overflow-x: auto;
}

.applications-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
}

.applications-table th {
    background: #f1f1f1;
    padding: 12px;
}

.applications-table td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #eee;
}

.applications-table tr:hover {
    background: #fafafa;
}

/* Status Badges */
.badge {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
}

.badge.pending {
    background: #fff3cd;
    color: #856404;
}

.badge.approved {
    background: #d4edda;
    color: #155724;
}

.badge.rejected {
    background: #f8d7da;
    color: #721c24;
}

/* Empty State */
.empty-state {
    background: #f8f9fa;
    padding: 30px;
    text-align: center;
    border-radius: 10px;
}

/* Apply Button */
.apply-section {
    margin-top: 30px;
    text-align: center;
}

.apply-btn {
    background: #4CAF50;
    color: white;
    padding: 12px 30px;
    border-radius: 8px;
    text-decoration: none;
    font-size: 16px;
    transition: 0.3s;
}

.apply-btn:hover {
    background: #388e3c;
}

.apply-btn.disabled {
    background: #ccc;
    cursor: not-allowed;
}

.pending-msg {
    color: #856404;
    background-color: #fff3cd;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 10px;
}

</style>
{% endblock %}
