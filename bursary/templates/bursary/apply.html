{% extends "bursary/base.html" %}
{% load static %}

{% block content %}
<h2>Submit Bursary Application</h2>

{% if messages %}
  {% for message in messages %}
    <div style="padding:10px;margin-bottom:10px;
      background:{% if message.tags == 'success' %}#2ecc71{% else %}#e74c3c{% endif %};
      color:white;">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

<form method="POST" enctype="multipart/form-data">
{% csrf_token %}
{{ form.non_field_errors }}

<style>
.errorlist { color:red; list-style:none; padding:0; }
fieldset { margin-top:20px; padding:15px; border:1px solid #ccc; }
legend { font-weight:bold; }
label { display:block; margin-top:10px; font-weight:600; }
.hidden { display:none; }
</style>

<!-- LOCATION -->
<label>County</label>
{{ form.county.errors }}
{{ form.county }}

<label>Constituency</label>
{{ form.constituency.errors }}
{{ form.constituency }}

<label>Level of Study</label>
{{ form.level_of_study.errors }}
{{ form.level_of_study }}

<!-- PERSONAL DETAILS -->
<fieldset>
<legend>Personal Details</legend>

<label>Full Name</label>
{{ form.full_name.errors }}
{{ form.full_name }}

<label>ID Number</label>
<input type="text" name="id_no">

<label>Birth Certificate Number</label>
<input type="text" name="birth_cert_no">

<label>Upload ID / Birth Certificate</label>
<input type="file" name="identity_document">

<label>Gender</label>
<input type="radio" name="gender" value="male"> Male
<input type="radio" name="gender" value="female"> Female

<label>Disability</label>
<input type="radio" name="disability" value="no" checked> No
<input type="radio" name="disability" value="yes"> Yes

<div id="disability_fields" class="hidden">
  <label>Type of Disability</label>
  <input type="text" name="disability_type">

  <label>Upload Disability Supporting Evidence</label>
  <input type="file" name="disability_document">
</div>
</fieldset>

<!-- EDUCATION DETAILS -->
<fieldset>
<legend>Educational Details</legend>

<label>Registration Number</label>
{{ form.admission_number.errors }}
{{ form.admission_number }}

<label>School</label>
{{ form.school.errors }}
{{ form.school }}

<label>Course of Study</label>
{{ form.course.errors }}
{{ form.course }}

<label>Year of Study</label>
{{ form.year_of_study.errors }}
{{ form.year_of_study }}

<label>Annual Fees Payable</label>
{{ form.amount_requested.errors }}
{{ form.amount_requested }}

<label>Upload Current Fee Structure</label>
{{ form.document.errors }}
{{ form.document }}

<label>Average Academic Performance</label>
<input type="radio" name="performance" value="excellent"> Excellent
<input type="radio" name="performance" value="very_good"> Very Good
<input type="radio" name="performance" value="good"> Good
<input type="radio" name="performance" value="fair"> Fair
<input type="radio" name="performance" value="poor"> Poor

<label>Upload Recent Transcript</label>
<input type="file" name="transcript">
</fieldset>

<!-- GEO DETAILS -->
<fieldset>
<legend>Geographical Details</legend>

<label>Polling Station</label>
<input type="text" name="polling_station">

<label>Sub-location</label>
<input type="text" name="sub_location">

<label>Location</label>
<input type="text" name="location">

<label>Ward</label>
<input type="text" name="ward">
</fieldset>

<!-- FAMILY DETAILS -->
<fieldset>
<legend>Family Details</legend>

<label>Family Status</label>
<input type="radio" name="family_status" value="both_alive"> Both Parents Alive  
<input type="radio" name="family_status" value="mother_dead"> Mother Alive, Father Deceased  
<input type="radio" name="family_status" value="father_dead"> Father Alive, Mother Deceased  
<input type="radio" name="family_status" value="single_mother"> Single Mother  
<input type="radio" name="family_status" value="single_father"> Single Father  
<input type="radio" name="family_status" value="orphan"> Total Orphan  

<!-- BOTH ALIVE -->
<div id="both_alive" class="hidden">
  <h4>Father Details</h4>
  <label>Father Name</label><input type="text" name="father_name">
  <label>Father Phone</label><input type="text" name="father_phone">
  <label>Father Occupation</label><input type="text" name="father_occupation">
  <label>Father ID Number</label><input type="text" name="father_id">

  <h4>Mother Details</h4>
  <label>Mother Name</label><input type="text" name="mother_name">
  <label>Mother Phone</label><input type="text" name="mother_phone">
  <label>Mother Occupation</label><input type="text" name="mother_occupation">
  <label>Mother ID Number</label><input type="text" name="mother_id">
</div>

<!-- MOTHER ALIVE -->
<div id="mother_dead" class="hidden">
  <h4>Mother Details</h4>
  <label>Name</label><input type="text" name="mother_name">
  <label>Phone</label><input type="text" name="mother_phone">
  <label>Occupation</label><input type="text" name="mother_occupation">
  <label>ID Number</label><input type="text" name="mother_id">
  <label>Upload Mother ID Copy</label><input type="file" name="mother_id_copy">

  <label>Father Death Certificate Number</label>
  <input type="text" name="father_death_no">
  <label>Upload Father Death Certificate</label>
  <input type="file" name="father_death_doc">
</div>

<!-- FATHER ALIVE -->
<div id="father_dead" class="hidden">
  <h4>Father Details</h4>
  <label>Name</label><input type="text" name="father_name">
  <label>Phone</label><input type="text" name="father_phone">
  <label>Occupation</label><input type="text" name="father_occupation">
  <label>ID Number</label><input type="text" name="father_id">
  <label>Upload Father ID Copy</label><input type="file" name="father_id_copy">

  <label>Mother Death Certificate Number</label>
  <input type="text" name="mother_death_no">
  <label>Upload Mother Death Certificate</label>
  <input type="file" name="mother_death_doc">
</div>

<!-- SINGLE MOTHER -->
<div id="single_mother" class="hidden">
  <label>Mother Name</label><input type="text" name="mother_name">
  <label>Mother Phone</label><input type="text" name="mother_phone">
  <label>Mother Occupation</label><input type="text" name="mother_occupation">
  <label>Mother ID Number</label><input type="text" name="mother_id">
  <label>Upload Mother ID Copy</label><input type="file" name="mother_id_copy">
</div>

<!-- SINGLE FATHER -->
<div id="single_father" class="hidden">
  <label>Father Name</label><input type="text" name="father_name">
  <label>Father Phone</label><input type="text" name="father_phone">
  <label>Father Occupation</label><input type="text" name="father_occupation">
  <label>Father ID Number</label><input type="text" name="father_id">
  <label>Upload Father ID Copy</label><input type="file" name="father_id_copy">
</div>

<!-- TOTAL ORPHAN -->
<div id="orphan" class="hidden">
  <label>Father Death Certificate Number</label>
  <input type="text" name="father_death_no">
  <label>Upload Father Death Certificate</label>
  <input type="file" name="father_death_doc">

  <label>Mother Death Certificate Number</label>
  <input type="text" name="mother_death_no">
  <label>Upload Mother Death Certificate</label>
  <input type="file" name="mother_death_doc">

  <h4>Guardian Details</h4>
  <label>Guardian Name</label><input type="text" name="guardian_name">
  <label>Guardian Phone</label><input type="text" name="guardian_phone">
  <label>Guardian Occupation</label><input type="text" name="guardian_occupation">
</div>
</fieldset>

<!-- SIBLINGS -->
<fieldset>
<legend>Number of Siblings in School</legend>
<label>Number of Siblings</label>
<input type="number" name="siblings_count">
</fieldset>

<!-- REFEREES (RESTORED) -->
<fieldset>
<legend>Referees</legend>

<label>Referee 1 Name</label>
<input type="text" name="referee1_name">
<label>Referee 1 Phone</label>
<input type="text" name="referee1_phone">

<label>Referee 2 Name</label>
<input type="text" name="referee2_name">
<label>Referee 2 Phone</label>
<input type="text" name="referee2_phone">
</fieldset>

<button type="submit">Submit Application</button>
</form>

<script>
/* Disability toggle */
document.querySelectorAll('input[name="disability"]').forEach(r=>{
  r.addEventListener('change',()=>{
    document.getElementById('disability_fields')
      .classList.toggle('hidden', r.value === 'no');
  });
});

/* Family logic */
const sections=['both_alive','mother_dead','father_dead','single_mother','single_father','orphan'];
document.querySelectorAll('input[name="family_status"]').forEach(r=>{
  r.addEventListener('change',()=>{
    sections.forEach(id=>document.getElementById(id).classList.add('hidden'));
    document.getElementById(r.value).classList.remove('hidden');
  });
});

/* County â†’ Constituency */
document.getElementById('id_county').addEventListener('change',function(){
  fetch(`/ajax/load-constituencies/?county=${this.value}`)
  .then(r=>r.json())
  .then(data=>{
    const c=document.getElementById('id_constituency');
    c.innerHTML='<option value="">Select constituency</option>';
    data.forEach(i=>c.innerHTML+=`<option value="${i.id}">${i.name}</option>`);
    c.disabled=false;
  });
});
</script>

{% endblock %}
